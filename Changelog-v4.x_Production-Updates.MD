# SysTune Changelog

## [v4.3] â€“ 2026-01-12 â€“ Production Release

### Service (`service.sh`)
- âœ… Converted main loop to **Zero-Fork architecture**; eliminated unnecessary `date`, `cat`, and `awk` forks.
- âš¡ Optimized **event-driven battery monitoring** (zone / charging state transitions).
- ğŸ”— Integrated **battery_safe worker** execution **only when charging**.
- ğŸ”„ Added **unplug detection** to immediately reset charging limits and state files.
- ğŸ›  Applied safe `renice` / `ionice` to reduce impact on foreground tasks.
- ğŸ›¡ Added existence guards for sourced scripts (`auto_profile.sh`, `battery_safe.sh`).

### Battery Safe Worker (`battery_safe.sh`)
- â›” Removed internal loop; now **triggered only by service.sh** (event-driven).
- ğŸŒ¡ Added **thermal guard with hysteresis** to prevent overheating; zero-fork logging using `/proc/uptime`.
- ğŸ”‹ Added **capacity-based charging pauses** (80%, 90%, 95%) with persistent state.
- ğŸ’¾ Implemented **atomic state persistence** to prevent corruption during rapid state changes.
- ğŸ Added **context guard** to exit early if device is not charging.
- ğŸ”„ Fully idempotent and robust against missing/deleted files.

### Logs & State
- ğŸ“ Unified logging format with monotonic timestamp.
- âš™ Battery safety thresholds correctly reflected in state file.
- ğŸ”‹ No CPU-intensive loops or unnecessary background forks; fully production-hardened.

---

**Notes:**
- This release ensures safe, efficient battery handling for MTK devices.
- Thermal and capacity thresholds are now dynamically managed with zero-fork architecture.
